-- =================================================
-- ПОЛНАЯ ПЕРЕЗАГРУЗКА БАЗЫ MATERIALS_DB
-- Удаляет все данные и вставляет заново
-- Кодировка: UTF-8
-- =================================================

SET client_encoding = 'UTF8';

-- =================================================
-- 1. ОЧИСТКА ТАБЛИЦ (в правильном порядке из-за внешних ключей)
-- =================================================

TRUNCATE TABLE public.material_route_steps CASCADE;
TRUNCATE TABLE public.material CASCADE;
TRUNCATE TABLE public.unit CASCADE;
TRUNCATE TABLE public."__EFMigrationsHistory" CASCADE;

-- =================================================
-- 2. ВСТАВКА ДАННЫХ В ТАБЛИЦУ unit
-- =================================================

INSERT INTO public.unit (id, code, name, description, type, status) VALUES
(1, 1001, 'УТО1', 'Узел транспортного оборудования 1', 'Area', 'Available'),
(2, 1002, 'УТО2', 'Узел транспортного оборудования 2', 'Area', 'Available'),
(3, 2001, 'Загрузка на участок 1', 'Участок загрузки материалов 1', 'Area', 'Available'),
(4, 2010, 'Загрузка на участок 2', 'Участок загрузки материалов 2', 'Area', 'Available'),
(5, 3001, 'НМК 1', 'Накопительная модульная конструкция 1', 'Area', 'Available'),
(6, 3002, 'НМК 2', 'Накопительная модульная конструкция 2', 'Area', 'Available'),
(7, 4001, 'Сортировочный стол 1', 'Стол для сортировки материалов 1', 'Area', 'Available'),
(8, 4002, 'Сортировочный стол 2', 'Стол для сортировки материалов 2', 'Area', 'Available'),
(9, 5001, 'Упаковка 1', 'Единица упаковки продукции 1', 'Area', 'Available'),
(10, 5002, 'Упаковка 2', 'Единица упаковки продукции 2', 'Area', 'Available'),
(11, 8001, 'Общий склад', 'Общий склад хранения материалов и труб', 'Warehouse', 'Available'),
(12, 6001, 'Выходной карман загрузки на участок 1', 'Выходной карман загрузки материалов 1', 'Area', 'Available');

-- =================================================
-- 3. ВСТАВКА ДАННЫХ В ТАБЛИЦУ material
-- =================================================

INSERT INTO public.material (id, code, name, description, parent_id, unit_id, pcs, mts, tns) VALUES
(1, 'TP-001', 'Труба стальная 57х3.5', 'Труба стальная электросварная 57х3.5, ст3', NULL, 11, 101.000, 6000.000, 2.500000),
(2, 'TP-002', 'Труба стальная 76х4', 'Труба стальная электросварная 76х4, ст3', NULL, 12, 1.000, 0.000, 0.000000),
(3, 'TP-003', 'Труба стальная 89х4', 'Труба стальная электросварная 89х4, ст3', NULL, 11, 1.000, 0.000, 0.000000),
(4, 'TP-004', 'Труба стальная 108х4', 'Труба стальная электросварная 108х4, ст3', NULL, 11, 1.000, 0.000, 0.000000),
(5, 'TP-005', 'Труба стальная 133х5', 'Труба стальная электросварная 133х5, ст3', NULL, 12, 1.000, 0.000, 0.000000),
(6, 'TP-006', 'Труба нержавеющая 25х2', 'Труба нержавеющая 25х2, AISI 304', NULL, 1, 1.000, 0.000, 0.000000),
(7, 'TP-007', 'Труба нержавеющая 32х2', 'Труба нержавеющая 32х2, AISI 304', NULL, 11, 1.000, 0.000, 0.000000),
(8, 'TP-008', 'Труба нержавеющая 38х2', 'Труба нержавеющая 38х2, AISI 304', NULL, 11, 120.000, 6000.000, 1.500000),
(9, 'TP-009', 'Труба оцинкованная 20х2.8', 'Труба оцинкованная 20х2.8, ГОСТ 3262-75', NULL, 11, 300.000, 6000.000, 1.000000),
(10, 'TP-010', 'Труба оцинкованная 25х3.2', 'Труба оцинкованная 25х3.2, ГОСТ 3262-75', NULL, 11, 250.000, 6000.000, 1.400000);

-- =================================================
-- 4. ВСТАВКА ДАННЫХ В ТАБЛИЦУ material_route_steps
-- =================================================

INSERT INTO public.material_route_steps (id, material_id, step_type, from_location, to_location, unit_id, operation_date, pcs, mts, tns, notes, created_at) VALUES
(1, 3, 'Registration', 'WAREHOUSE', 'SECTION_packing1', 1, '2025-12-21 14:53:04.223+00', 1.000, 0.000, 0.000000, 'Материал Труба стальная 89х4 (TP-003) зарегистрирован на участке packing1. Количество: 1 шт.', '2025-12-21 14:53:10.171261+00'),
(2, 2, 'Registration', 'WAREHOUSE', 'SECTION_loading1', 1, '2025-12-21 15:01:36.31+00', 1.000, 0.000, 0.000000, 'Материал Труба стальная 76х4 (TP-002) зарегистрирован на участке loading1. Количество: 1 шт.', '2025-12-21 15:01:55.730936+00'),
(3, 4, 'Registration', 'WAREHOUSE', 'SECTION_loading1', 1, '2025-12-21 15:12:50.304+00', 1.000, 0.000, 0.000000, 'Материал Труба стальная 108х4 (TP-004) зарегистрирован на участке loading1. Количество: 1 шт.', '2025-12-21 15:12:50.315778+00'),
(4, 6, 'Registration', 'WAREHOUSE', 'SECTION_loading1', 1, '2025-12-21 15:13:04.937+00', 1.000, 0.000, 0.000000, 'Материал Труба нержавеющая 25х2 (TP-006) зарегистрирован на участке loading1. Количество: 1 шт.', '2025-12-21 15:13:04.950796+00'),
(5, 7, 'Registration', 'WAREHOUSE', 'SECTION_loading1', 1, '2025-12-21 15:17:55.368+00', 1.000, 0.000, 0.000000, 'Материал Труба нержавеющая 32х2 (TP-007) зарегистрирован на участке loading1. Количество: 1 шт.', '2025-12-21 15:17:55.379046+00'),
(6, 4, 'Registration', 'WAREHOUSE', 'SECTION_loading1', 1, '2025-12-21 15:24:10.633+00', 1.000, 0.000, 0.000000, 'Материал Труба стальная 108х4 (TP-004) зарегистрирован на участке loading1. Количество: 1 шт.', '2025-12-21 15:24:10.642576+00'),
(7, 4, 'Return', 'SECTION_loading1_LOADING', 'WAREHOUSE_GENERAL', 11, '2025-12-21 17:07:32.322+00', 1.000, 0.000, 0.000000, 'Материал Труба стальная 108х4 (TP-004) удален с участка loading1', '2025-12-21 17:07:32.334053+00'),
(8, 7, 'Return', 'SECTION_loading1_LOADING', 'WAREHOUSE_GENERAL', 11, '2025-12-21 17:07:49.164+00', 1.000, 0.000, 0.000000, 'Материал Труба нержавеющая 32х2 (TP-007) удален с участка loading1', '2025-12-21 17:07:49.176248+00'),
(9, 6, 'Return', 'SECTION_loading1_LOADING', 'WAREHOUSE_GENERAL', 11, '2025-12-21 17:07:50.371+00', 1.000, 0.000, 0.000000, 'Материал Труба нержавеющая 25х2 (TP-006) удален с участка loading1', '2025-12-21 17:07:50.378942+00'),
(10, 2, 'Return', 'SECTION_loading1_LOADING', 'WAREHOUSE_GENERAL', 11, '2025-12-21 17:07:51.28+00', 1.000, 0.000, 0.000000, 'Материал Труба стальная 76х4 (TP-002) удален с участка loading1', '2025-12-21 17:07:51.291896+00'),
(11, 3, 'Return', 'SECTION_loading1_LOADING', 'WAREHOUSE_GENERAL', 11, '2025-12-21 17:07:52.012+00', 1.000, 0.000, 0.000000, 'Материал Труба стальная 89х4 (TP-003) удален с участка loading1', '2025-12-21 17:07:52.020218+00'),
(12, 7, 'Registration', 'WAREHOUSE', 'SECTION_loading1', 1, '2025-12-21 17:09:30.507+00', 1.000, 0.000, 0.000000, 'Материал Труба нержавеющая 32х2 (TP-007) зарегистрирован на участке loading1. Количество: 1 шт.', '2025-12-21 17:09:30.518597+00'),
(13, 7, 'Return', 'SECTION_loading1_LOADING', 'WAREHOUSE_GENERAL', 11, '2025-12-23 19:21:04.292+00', 1.000, 0.000, 0.000000, 'Материал Труба нержавеющая 32х2 (TP-007) удален с участка loading1', '2025-12-23 19:21:04.354008+00'),
(14, 5, 'Return', 'SECTION_loading1_LOADING', 'WAREHOUSE_GENERAL', 11, '2025-12-23 19:24:10.852+00', 1.000, 0.000, 0.000000, 'Материал Труба стальная 133х5 (TP-005) удален с участка loading1', '2025-12-23 19:24:10.86602+00'),
(15, 5, 'Registration', 'WAREHOUSE', 'SECTION_loading1', 1, '2025-12-23 19:24:22.917+00', 1.000, 0.000, 0.000000, 'Материал Труба стальная 133х5 (TP-005) зарегистрирован на участке loading1. Количество: 1 шт.', '2025-12-23 19:24:22.927183+00'),
(16, 5, 'Transfer', 'SECTION_loading1_LOADING', 'SECTION_loading1_OUTPUT', 12, '2025-12-23 19:57:31.713+00', 1.000, 0.000, 0.000000, 'Материал Труба стальная 133х5 (TP-005) перемещен на обработку с участка loading1', '2025-12-23 19:57:31.725974+00'),
(17, 6, 'Registration', 'WAREHOUSE', 'SECTION_loading1', 1, '2025-12-23 20:21:00.886+00', 1.000, 0.000, 0.000000, 'Материал Труба нержавеющая 25х2 (TP-006) зарегистрирован на участке loading1. Количество: 1 шт.', '2025-12-23 20:21:00.902515+00');

-- =================================================
-- 5. ВСТАВКА ДАННЫХ В ТАБЛИЦУ __EFMigrationsHistory
-- =================================================

INSERT INTO public."__EFMigrationsHistory" ("MigrationId", "ProductVersion") VALUES
('20251207145408_InitialCreate', '8.0.0'),
('20251209131811_InitialCreate', '8.0.0'),
('20251209132107_InitialCreate', '8.0.0'),
('20251209135142_InitialCreate', '8.0.0'),
('20251209135320_InitialCreate', '8.0.0'),
('20251209140319_InitialCreate', '8.0.0'),
('20251210120517_InitialCreate', '8.0.0'),
('20251210121541_InitialCreate', '8.0.0');

-- =================================================
-- 6. ВОССТАНОВЛЕНИЕ СЕКВЕНЦИЙ (для автоинкремента)
-- =================================================

SELECT setval('public.material_id_seq', (SELECT MAX(id) FROM public.material));
SELECT setval('public.material_route_steps_id_seq', (SELECT MAX(id) FROM public.material_route_steps));
SELECT setval('public.unit_id_seq', (SELECT MAX(id) FROM public.unit));

-- =================================================
-- 7. ПРОВЕРКА
-- =================================================

SELECT 'Проверка unit:' as check_name, COUNT(*) as count FROM public.unit
UNION ALL
SELECT 'Проверка material:', COUNT(*) FROM public.material
UNION ALL
SELECT 'Проверка material_route_steps:', COUNT(*) FROM public.material_route_steps
UNION ALL
SELECT 'Проверка __EFMigrationsHistory:', COUNT(*) FROM public."__EFMigrationsHistory";

SELECT 'Готово! Данные восстановлены.' as result;